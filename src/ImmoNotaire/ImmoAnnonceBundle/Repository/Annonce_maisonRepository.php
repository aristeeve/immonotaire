<?php

namespace ImmoNotaire\ImmoAnnonceBundle\Repository;

/**
 * Annonce_maisonRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class Annonce_maisonRepository extends \Doctrine\ORM\EntityRepository
{
    
    public function rechercheMaison(array $param) {

        $query = $this->createQueryBuilder('a')
                ->leftJoin('a.annonce', 'news')
                ->addSelect('news');

        $query->where($query->expr()->orX($query->expr()->eq('news.type_annonce', ':typeannonce')))
                ->setParameter('typeannonce', $param['type_annonce'])
                ->andWhere($query->expr()->orX($query->expr()->eq('news.active', ':active')))
                ->setParameter('active', 1) //active
                ->andWhere($query->expr()->orX($query->expr()->eq('news.supprimer', ':supprimer')))
                ->setParameter('supprimer', 0); // supprimÃ©
        if (!empty($param['ville'])) {
            $query->andWhere($query->expr()->orX($query->expr()->eq('news.ville', ':ville')))
                    ->setParameter('ville', $param['ville']); //ville
        }
        if (!empty($param['type_biens'])) {
            $query->andWhere($query->expr()->orX($query->expr()->eq('news.type_biens', ':typeBiens')))
                    ->setParameter('typeBiens', $param['type_biens']); //appart ou autre
        }
         if (!empty($param['type_maison'])) {
            $query->andWhere($query->expr()->orX($query->expr()->eq('a.type_maison', ':typeMaison')))
                    ->setParameter('typeMaison', $param['type_maison']); //appart ou autre
        }
        
        if (!empty($param['superficie'])) {
            $query->andWhere($query->expr()->orX($query->expr()->eq('a.superficie', ':superficie')))
                    ->setParameter('superficie', $param['superficie']);
        }
        if (!empty($param['piece'])) {
            $query->andWhere($query->expr()->orX($query->expr()->eq('a.piece', ':piece')))
                    ->setParameter('piece', $param['piece']);
        }
        if (!empty($param['prix'])) {
            $query->andWhere($query->expr()->orX($query->expr()->lte('news.prix', ':prix')))
                    ->setParameter('prix', $param['prix']);
        }

        return $query->getQuery()->getResult();
    }

}
